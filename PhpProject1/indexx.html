<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.2/angular.js"></script>
        <script>
        var app = angular.module('myApp', []);
        app.controller('myController', function($scope, $http) {
            $scope.resp = "";
            $scope.name = [""];
            $scope.list = [""];
            $scope.errormsg = "";
            $scope.addName = function()
            {
                if($scope.name.length == $scope.number && $scope.hasEmpty() == false)
                {
                    $http({
                        method: 'POST',
                        url: 'testing.php',
                        data: 'list=' + $scope.name,
                        headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                    }).then(function success(response) {
                            $scope.resp = response.data;
                            $scope.errormsg = "Added names succesfully";

                        },
                        function error(response) {
                            $scope.resp = response.statusText;
                            $scope.errormsg = "Something went wrong:" + response.statusText;
                        });
                }
                else if($scope.name.length < $scope.number || $scope.hasEmpty() == true)
                    $scope.errormsg = "Error 101: Not all fields have been initialized";
                else if($scope.number <= 0)
                    $scope.errormsg = "Error 102: Make sure fields have been initialized";
                else
                    $scope.errormsg = "Error 103: Make sure unused submission areas have been cleared";

             };
            $scope.num = function ()
            {
                return new Array($scope.number);

            }
            $scope.removeName = function(x)
            {
                $scope.name.splice(x,1);
                $scope.number--;
             }
             $scope.reset = function()
             {
                 $scope.name = angular.copy($scope.list);
                 $scope.number = 1;
                 $scope.errormsg = "";
             }
             $scope.hasEmpty = function()
             {
                 for (var i = 0; i < $scope.name.length; i++)
                 {
                     if($scope.name[i] == "" || $scope.name[i] == null)
                         return true;
                 }
                 return false;
             }

        });
        </script>
        <h1>Wedding RSVP</h1>
     </head>

    <body>
    <div ng-app="myApp" ng-controller="myController">
        <p>What is the total amount of people coming?</p>
        <input type="number"
               placeholder="Select number"
               ng-model="number">

        <p>Enter full name(s):</p>
        <div ng-repeat="x in num() track by $index">
            <input type="text"
                   placeholder="Enter name here"
                   ng-model="name[$index]">
            <span class="w3-padding-16"
                  class="w3-right w3-margin-right"
                  style="cursor: pointer;"
                  ng-click="removeName($index)">x</span>
        </div>

        <p></p>

        <button ng-click="addName()"
                ng-if="name.length"
                class="w3-btn w3-padding w3-green">
            Add names</button>

        <button ng-click="reset()"
                class="w3-btn w3-padding w3-red">
            Reset</button>

        <p style="color: red">{{errormsg}}</p>

        <!-- Tests for dev -->
        <p>{{name}}</p>
        <p> List: {{list}}</p>
        <p>Response: {{resp}}</p>

    </div>
   </body>

</html>
